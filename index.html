<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مطعم رغيف الفيصلية - القائمة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <style>
        :root {
            --bg-color: #f8f4f0;
            --surface-color: #ffffff;
            --primary-color: #d87525;
            --primary-color-dark: #b85e1a;
            --text-color-primary: #3d352e;
            --text-color-secondary: #7a6a5d;
            --accent-color: #28a745;
            --border-color: #e0d5c1;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --font-family: 'Tajawal', sans-serif;
        }

        /* --- Loading Screen & General Styles --- */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #fff; display: flex; justify-content: center;
            align-items: center; z-index: 9999; transition: opacity 0.7s ease-out, visibility 0.7s ease-out;
        }
        #loading-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        #loading-screen img { max-width: 250px; animation: pulse 1.8s infinite ease-in-out; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-family); background-color: var(--bg-color);
            color: var(--text-color-primary); line-height: 1.7; overflow-x: hidden;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .currency-symbol {
            display: inline-block; width: 0.9em; height: 0.9em;
            vertical-align: -0.1em; margin: 0 2px;
            content: url('https://upload.wikimedia.org/wikipedia/commons/thumb/9/98/Saudi_Riyal_Symbol.svg/800px-Saudi_Riyal_Symbol.svg.png');
        }

        /* --- Top Navbar --- */
        .navbar {
            background-color: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px);
            padding: 12px 20px; box-shadow: 0 2px 10px var(--shadow-color);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }
        .navbar-brand { font-size: 1.8em; font-weight: 800; color: #b12128; text-decoration: none; }
        .cart-toggle-button {
            background: none; border: none; font-size: 1.6em; color: #b12128;
            cursor: pointer; position: relative; padding: 8px; text-decoration: none;
        }
        .cart-count-badge {
            position: absolute; top: 0px; right: 0px; background-color: var(--primary-color);
            color: white; font-size: 0.6em; padding: 3px 7px; border-radius: 50%;
            font-weight: 700; border: 2px solid white;
        }
        
        /* --- Page Header & Content --- */
        .page-header { text-align: center; margin: 40px 0; }
        .page-header img { max-width: 300px; margin-bottom: 15px; }
        .page-title { font-size: 2.8em; font-weight: 800; color:#b12128; }
        .search-controls { display: flex; justify-content: space-between; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .search-container { position: relative; flex-grow: 1; }
        #search-input { width: 100%; padding: 12px 20px 12px 45px; border: 1px solid var(--border-color); background: var(--surface-color); border-radius: 25px; font-family: var(--font-family); font-size: 1em; outline: none; box-shadow: 0 2px 8px var(--shadow-color); transition: border-color 0.3s, box-shadow 0.3s; }
        #search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(216, 117, 37, 0.2), 0 2px 8px var(--shadow-color); }
        .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: #aaa; }
        
        /* --- View Toggle Button --- */
        .view-toggle-btn {
            background-color: var(--surface-color); color: var(--text-color-secondary);
            border: 1px solid var(--border-color); padding: 10px 14px; border-radius: 25px;
            cursor: pointer; font-size: 1.2em; transition: all 0.3s ease;
            box-shadow: 0 2px 8px var(--shadow-color); flex-shrink: 0;
        }
        .view-toggle-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }
        .view-toggle-btn.active-compact-view { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }

        .filters-container-wrapper { overflow-x: auto; padding-bottom: 10px; margin-bottom: 30px; }
        .filters-container-wrapper::-webkit-scrollbar { height: 6px; }
        .filters-container-wrapper::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 10px; }
        .filters-container { display: flex; flex-wrap: nowrap; gap: 12px; padding: 5px 0; }
        .filter-btn { background-color: rgba(255, 255, 255, 0.7); color: var(--text-color-secondary); border: 1px solid var(--border-color); padding: 10px 22px; border-radius: 22px; cursor: pointer; font-size: 1em; font-family: var(--font-family); font-weight: 500; transition: all 0.3s ease; white-space: nowrap; }
        .filter-btn:hover { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .filter-btn.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color-dark); font-weight: 700; box-shadow: 0 2px 5px rgba(216, 117, 37, 0.3); }
        .category-section { margin-bottom: 50px; }
        .category-title { font-size: 2em; font-weight: 700; margin-bottom: 25px; text-align: right; padding-bottom: 10px; border-bottom: 3px solid var(--primary-color); display: inline-block; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .product-card { background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 4px 15px var(--shadow-color); transition: all 0.3s ease; display: flex; flex-direction: column; overflow: hidden; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.12); }
        .product-card img { width: 100%; height: 200px; object-fit: cover; transition: all 0.3s ease; }
        .product-card:hover img { transform: scale(1.05); }
        .product-info { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; text-align: right; }
        .product-card h3 { margin: 0 0 5px 0; font-size: 1.25em; font-weight: 700; }
        .product-description { font-size: 0.9em; color: var(--text-color-secondary); margin-bottom: 15px; min-height: 45px; transition: all 0.3s ease; }
        .price-and-action { display: flex; justify-content: space-between; align-items: center; margin-top: auto; transition: all 0.3s ease; }
        .product-card .price { font-size: 1.3em; font-weight: 800; color: #1e191a; }
        .product-card .action-btn { background-color: var(--primary-color); color: white; border: none; padding: 10px 18px; font-size: 0.95em; font-family: var(--font-family); font-weight: 500; border-radius: 8px; cursor: pointer; transition: background-color 0.3s, transform 0.2s; display: flex; align-items: center; gap: 8px; }
        .product-card .action-btn:hover { background-color: var(--primary-color-dark); transform: scale(1.05); }
        .product-attributes { display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 8px; margin: 0 0 10px; min-height: 22px; }
        .attr-icon { display: inline-block; width: 22px; height: 22px; background-size: contain; background-repeat: no-repeat; background-position: center; position: relative; }
        .attr-icon::after { content: attr(title); position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background-color: var(--text-color-primary); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; white-space: nowrap; opacity: 0; visibility: hidden; z-index: 10; transition: opacity 0.2s, visibility 0.2s; pointer-events: none; }
        .attr-icon:hover::after { opacity: 1; visibility: visible; }
        .attr-icon--salt { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEh0ULR_-qfH3jXKRAVLOhyEBz6iMMh9Om5zWuw2ApOSfRPBgxRyDM5ho6hCW18gu8lZGkrFS5Qt5PjTDq1JKiQldnIviLBGZTOJzS3lDk9oZjULYgxtL_N7CBieqX3W_xXPlZXasN9g-dYc5wWBtc_09tJXBwfDCw6Hx8gM6Xtz5wLUZ2XtukEJRVzpLQ6I"); }
        .attr-icon--pepper { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEg0oX6tnFyk_-dfBr9Vh7IOZeH9PKh93414Nw1zsB7idRHoSvDhK7KdX61w6QMt0cfpZJrWHFFbxJoaCiyN1B9z5KxtYgBwP3PbnBdSzvHCJgM3THm5BUOD1Np1iAu7anVYEI-NQI94DPcH_ta2ZA5Ga0lq9nquQXvNfoyiYJpTwMf9qnNGTQnvyLDrkRx5"); }
        .attr-icon--spicy { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEhNganEQwvnDVOpjznRnQqFv4m_VgajDdS7scUDFdsJFjR9oTJkZrG1xWWH-Ojdhh5zPZPZ2QxDG9Gw2DmNJl0KD9_HlhTIYsjhJcpJb_efoSsPPoBIM5ZD_GXUMXlHrB3pDH8GxqRPzzG5A273fy8XRSHT2MIDydFWfJq5_QG7KM2UGcuQCOH7tM3VYYHK"); }
        .attr-icon--wheat { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEivRE0H0a-Azi_4gE7q4cYGb1N_oexjm6OfZJ7UxhnWtjLp9qF81MGoLHZXkZPTJA2XhVwcZu62DCnB3FmcolDGtg6b-Nvwx4zu-vcBMjodgq7u33YpMB8CawjyIAl0kNL4FF0u28QzxxJ61fsmPbc8_1yLIk3Kn4TiHI-vAu9_535UMN_YyfIV1eaM6pqm"); }
        .attr-icon--milk { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEgETisjhlYtOYMh5MSlcKDP86n3zj7t5kHdvXhmmmByAqu-dFcNhYHIEJuTbZJanGQVUorWV4_w5KB1JqeoReLm4HONWChdtTG5koSA8OgfIKBL5mAbmBqnlF459y6mlqIigk2ghVLL9Gf6CpfH9s3XBg9VHyiJr_GBhn6UWKwGx3BlCKRk7mtFtfWQ2-lj"); }
        .attr-icon--egg { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEgsDg7Vfj6VKKZT64bAsy9SQI6NwdCT0R5QS5REDIcESfqP7QDPUmVPy-kX8-btWiFjzKBOcpWq8v0R1P2THTD6TQDx_4WHLvEmjVrDAUVpx1s1LsW-L3A-a6Xo-QENBryfeZxmQdlyDXgEFQuPMGci27I7uCxiXbGr-dT3ksz8Fg6XZtPLIrBX63SpyQ9l"); }
        .attr-icon--nuts { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEhK9JloKvsYuje0UIj_dMoJhJiIgMuAkKXlnlxbTLYQrRdpjQPR0osOCmGfVPS3drn3j5lGIReUYBPiaJpsbXY-NIH4rFwraEXafe--uDzz9VylHHX4CAgrWh2kLijzpMGKWe_JWL9GdKLdGda_mQWiBhM6AXN16BEacc3mxpHyvMJLg6ftaksMQPbUT0vg"); }
        .attr-icon--peanut { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEjMGhMiRYtg67oQSdC3vzQbra3KEKELN1JMGAfhHqD7-WjW6wyj0dBQsB6kBEAvnKgYMDtD4gGny_JEZRItm89RN7DXmRd9_MYulukoB-06r3XIe5Aw83D7zc1Ozr3BibW7ATeA_K3TYXiklgGLhCRAVfkuKmakr9pohRj6rScWiPJd7uVkpgavPtCCyDsS"); }
        .attr-icon--fish { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEgvzL0lv4dvOOnYHJYmlHAFmvKKB8biBXIV2OpyQBIwJ8Akendu1J9qvjUOe9A5h3TWP9-ZOw--hyXziRDGfYhKA2KFu142RhmIs_pEkycz1kcroAPFxiYuE09JDpZndKe20TdXVTTEHYIPcqga9SevOkVkUFN9LerrRtoYZ4KcAzZzF4fWYLQIRz0YkMRu"); }
        .attr-icon--shellfish { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEhsrtwPjfrCvjd6LBn8QiM_mLuBh1LashDhPR5zKfRIusp68OACFChwrGLwGlXbqTRnAx8MtwiXZLbhitopsjQRuZvuO88uR4jcUHqmABqN8Opi5DhqmFHGrNTT_knv70yZdpPASbbXBH3ue0cUOnGj2O89ACQch7y3j5cJmTYN36Sut2WNOGl9_qGaNNfa"); }
        .attr-icon--soy { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEhuk7XfzJjfrqRkVY7SR9sX9u5eoM7N0iYkcBHtr3os8d79U1K9pOqAebeEEPv1Ys09CMr2FyQrDkY_OCHpGtOzJiovLlP5FcM947LGlZXPoGb-uV-VZYMGEYoz2BEc9ahzajCalOGr6Z0WAdhz2LF6CeQb8GEGD-Gu3VUR_RQozACHk3D1KJKKSVbicfKf"); }
        .attr-icon--sesame { background-image: url("https://blogger.googleusercontent.com/img/a/AVvXsEj5WRTqKm_NErM7KVOgFwOW823p2xtR_1Z6__rGAI49S2ZI4h0AS0giS63ohdFjQ5iv04KHNTn4aEY-HyKUObjxaRYEPo3nH1LDCIgN_EI2ZtIoGQXNupERPlcJweOCDq0l5UkJxm7wr-evdtV7q5pp9odYmfstNKbBfCw2P2XERJLRVq3hA0jo-88Na_KE"); }

        /* --- Compact View Styles --- */
        body.compact-view .products-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        body.compact-view .product-card img { height: 120px; }
        body.compact-view .product-card h3 { font-size: 1.1em; }
        body.compact-view .product-description { min-height: 20px; font-size: 0.8em; margin-bottom: 10px; }
        body.compact-view .price-and-action { flex-direction: column; align-items: stretch; gap: 10px; }
        body.compact-view .product-card .price { text-align: center; }

        /* --- Modal Styles (General) --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 1001; justify-content: center; align-items: center; }
        .modal-overlay.active { display: flex; }
        .modal-content { background-color: var(--surface-color); padding: 20px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative; animation: fadeInModal 0.3s ease-out; }
        @keyframes fadeInModal { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-close-btn { position: absolute; top: 15px; left: 15px; background: none; border: none; font-size: 2.5em; color: #aaa; cursor: pointer; line-height: 1; z-index: 10; }
        
        /* "About Us" Modal Content */
        .about-header { text-align: center; margin-bottom: 25px; }
        .about-header img { max-width: 200px; margin-bottom: 10px; }
        .about-header h2 { font-size: 2em; color: #b12128; }
        .about-section { margin-bottom: 25px; }
        .about-section h4 { font-size: 1.3em; color: var(--primary-color); margin-bottom: 15px; text-align: center; }
        .about-socials { text-align: center; }
        .about-socials a { color: var(--text-color-primary); font-size: 1.8em; margin: 0 12px; transition: color 0.3s, transform 0.2s; }
        .about-socials a:hover { color: var(--primary-color); transform: translateY(-3px); }
        .allergen-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .allergen-table td { padding: 10px; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        .allergen-table td:first-child { width: 40px; text-align: center; }
        .about-footer { margin-top: 30px; text-align: center; font-size: 0.85em; color: var(--text-color-secondary); }
        .about-footer p { margin-bottom: 5px; }
        
        /* Customization Modal */
        #customization-modal-overlay .modal-content { max-width: 550px; }
        .modal-product-image { width: 100%; height: 220px; object-fit: cover; border-radius: 8px; margin-bottom: 20px; }
        .modal-product-title { font-size: 1.8em; color: var(--primary-color); margin-bottom: 10px; text-align: center; font-weight: 700; }
        .modal-product-base-price, .modal-current-item-price { text-align: center; margin-bottom: 15px; }
        .modal-product-base-price { font-size: 1.2em; color: var(--text-color-secondary); }
        .modal-current-item-price { font-size: 1.3em; color: var(--primary-color); font-weight: bold; margin-top: 5px; }
        .modal-customizations .option-group { margin-bottom: 20px; border-top: 1px solid var(--border-color); padding-top: 15px; }
        .modal-customizations .option-group legend { font-weight: 700; margin-bottom: 10px; font-size: 1.1em; }
        .modal-customizations .option-item { display: block; margin-bottom: 8px; font-size: 1em; }
        .modal-customizations .option-item label { margin-right: 8px; cursor: pointer; }
        .modal-customizations .option-item input { margin-left: 10px; }
        .modal-quantity-controls { display: flex; justify-content: center; align-items: center; margin: 25px 0; }
        .modal-quantity-controls input[type="number"] { width: 70px; padding: 10px; text-align: center; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1.1em; margin: 0 10px; }
        .modal-add-to-cart-btn { background-color: var(--primary-color); color: white; border: none; padding: 14px 25px; text-align: center; display: block; width: 100%; font-size: 1.2em; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; }
        .modal-add-to-cart-btn:hover { background-color: var(--primary-color-dark); }
        
        /* --- Cart Modal Styles --- */
        #cart-modal-overlay .modal-content { max-width: 800px; }
        .checkout-header h2 { font-size: 2em; color: var(--primary-color); font-weight: 800; text-align: center; margin-bottom: 25px; }
        .cart-items-list-container { max-height: 300px; overflow-y: auto; padding: 0 10px; margin-bottom: 20px; background: #fafafa; border-radius: 8px; border: 1px solid #eee; }
        .cart-items-list { list-style-type: none; padding: 0; }
        .cart-items-list li { padding: 15px 10px; border-bottom: 1px dashed #ddd; display: flex; justify-content: space-between; align-items: flex-start; }
        .cart-item-details { flex-grow: 1; margin-right: 15px; }
        .cart-item-details .item-name { font-weight: 700; font-size: 1.1em; }
        .cart-item-details .item-customizations { font-size: 0.85em; color: var(--text-color-secondary); margin-top: 5px; }
        .cart-item-actions { text-align: left; flex-shrink: 0;}
        .item-total-price { font-weight: bold; display: block; }
        .remove-item-btn { background: none !important; color: #e74c3c !important; border: none; padding: 5px !important; font-size: 1em !important; cursor: pointer; margin-top: 5px; }
        #empty-cart-message { text-align: center; color: var(--text-color-secondary); padding: 40px 20px; font-size: 1.1em; }
        #checkout-footer-section { padding-top: 20px; border-top: 1px solid var(--border-color); }
        .delivery-options, .payment-options { margin-bottom: 15px; text-align: center; }
        .delivery-options label, .payment-options label { margin: 0 10px; }
        #location-section { display: none; margin-top: 15px; padding: 15px; background-color: #fffaf2; border: 1px dashed var(--primary-color); border-radius: 8px; text-align: center; }
        #get-location-btn { background-color: #555; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: var(--font-family); font-size: 1em; transition: background-color 0.3s; }
        #get-location-btn.success { background-color: var(--primary-color); }
        #location-feedback { margin-top: 10px; font-size: 0.9em; color: var(--text-color-secondary); }
        #location-feedback a { color: var(--primary-color); font-weight: bold; }
        .payment-options-title { display: block; margin-bottom: 10px; font-weight: 700; }
        #general-order-notes { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 8px; min-height: 70px; font-family: var(--font-family); font-size: 1em; }
        .summary-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1em; }
        .summary-line.total { font-weight: 700; font-size: 1.3em; color: var(--primary-color); margin-top: 10px; }
        .cart-actions { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .checkout-btn-whatsapp { width: 100%; background-color: #25D366; color: white; border: none; padding: 14px 20px; font-size: 1.1em; font-weight: 700; border-radius: 8px; transition: background-color 0.3s; cursor: pointer; }
        .checkout-btn-whatsapp:hover { background-color: #1ebe58; }
        .clear-cart-btn { width: 100%; background-color: #95a5a6; color: white; font-size: 0.9em; padding: 10px 15px; border-radius: 8px; cursor: pointer; border: none;}
        .map-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; }
        .map-modal-content { background-color: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 700px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .map-modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .map-modal-header h3 { color: var(--primary-color); font-size: 1.5em; }
        .map-modal-close-btn { background: none; border: none; font-size: 2.5em; color: #aaa; cursor: pointer; line-height: 1; }
        #map { height: 400px; width: 100%; border-radius: 8px; border: 1px solid var(--border-color); }
        .map-modal-footer { text-align: center; margin-top: 15px; }
        #confirm-location-btn { background-color: var(--primary-color); color: white; border: none; padding: 12px 30px; font-family: var(--font-family); font-size: 1.1em; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; }
        #confirm-location-btn:hover { background-color: var(--primary-color-dark); }
        
        /* --- Notification Toast --- */
        .notification-toast {
            position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
            background-color: var(--accent-color); color: white;
            padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1003; transition: bottom 0.5s ease, opacity 0.5s ease;
            display: flex; align-items: center; gap: 10px;
            opacity: 0;
        }
        .notification-toast.show { bottom: 30px; opacity: 1; }

        /* --- Mobile Bottom Navigation --- */
        .mobile-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--surface-color); box-shadow: 0 -2px 10px var(--shadow-color); z-index: 1001; }
        .nav-list { display: flex; list-style: none; margin: 0; padding: 0; }
        .nav-item { flex: 1; text-align: center; padding: 8px 0; text-decoration: none; color: var(--text-color-secondary); display: flex; flex-direction: column; align-items: center; gap: 4px; transition: color 0.2s; position: relative; cursor: pointer; }
        .nav-item .cart-count-badge { right: calc(50% - 25px); top: 2px;}
        .nav-item i { font-size: 1.4em; }
        .nav-item span { font-size: 0.8em; font-weight: 500; }
        .nav-item.active { color: var(--primary-color); }
        
        /* --- Media Queries --- */
        @media (max-width: 768px) {
            body { padding-bottom: 80px; }
            .mobile-nav { display: block; }
            .navbar .cart-toggle-button { display: none; }
            .notification-toast.show { bottom: 80px; } 
            body.compact-view .products-grid { grid-template-columns: repeat(2, 1fr); }
        }

    </style>
</head>
<body>

    <div id="loading-screen">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhGHYYhphUac3HG8T-OFi-5IZJMRRA9feFb0dbYZjPZY2gm7-GZzEoF61Nx1VLps5DB3tw17hM8UcrUT_Sxo631yxp4tOPZu8lCCVnpdiQ1n4i7EfUvpYK2KxYDKSX44XZhFH3_MmYwuoQGUUnB99DyWHj4cR4yjlvBSiZjqA4jWurYWFvhBaVv34Mnko6o/s1007/vydt.png" alt="جاري التحميل...">
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="about-us-modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="about-us-modal-close-btn">&times;</button>
            <div class="about-header"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhGHYYhphUac3HG8T-OFi-5IZJMRRA9feFb0dbYZjPZY2gm7-GZzEoF61Nx1VLps5DB3tw17hM8UcrUT_Sxo631yxp4tOPZu8lCCVnpdiQ1n4i7EfUvpYK2KxYDKSX44XZhFH3_MmYwuoQGUUnB99DyWHj4cR4yjlvBSiZjqA4jWurYWFvhBaVv34Mnko6o/s1007/vydt.png" alt="شعار المطعم"><h2>مطعم رغيف الفيصلية</h2></div>
            <div class="about-section"><h4>تواصل معنا</h4><div class="about-socials"><a href="#" aria-label="موقعنا على الخريطة"><i class="fas fa-map-marker-alt"></i></a><a href="#" aria-label="تيك توك"><i class="fab fa-tiktok"></i></a><a href="#" aria-label="إنستغرام"><i class="fab fa-instagram"></i></a><a href="#" aria-label="واتساب"><i class="fab fa-whatsapp"></i></a></div></div>
            <div class="about-section"><h4>مسببات الحساسية</h4><table class="allergen-table"></table></div>
            <div class="about-footer"><p>يحتاج البالغون تقريباً إلى 2000 سعرة حرارية في المتوسط يوميا.</p><p>© <span id="current-year"></span> جميع الحقوق محفوظة لفريق حاجب سوفت.</p></div>
        </div>
    </div>

    <div class="modal-overlay" id="cart-modal-overlay">
        <div class="modal-content"><button class="modal-close-btn" id="cart-modal-close-btn">&times;</button><div class="checkout-header"><h2>طلباتك</h2></div><div class="cart-items-list-container"><ul id="cart-items-list" class="cart-items-list"></ul></div>
            <div id="checkout-footer-section"><div class="delivery-options"><label><input type="radio" name="deliveryType" value="pickup" checked> استلام</label><label><input type="radio" name="deliveryType" value="delivery"> توصيل</label></div>
                <div id="location-section"><button id="get-location-btn">📍 حدد موقعك</button><p id="location-feedback"></p></div>
                <div class="payment-options"><span class="payment-options-title">الدفع:</span><label><input type="radio" name="paymentMethod" value="cash" checked> كاش</label><label><input type="radio" name="paymentMethod" value="network"> شبكة</label></div>
                <textarea id="general-order-notes" placeholder="ملاحظات إضافية..."></textarea>
                <div class="summary-line"><span>المجموع الفرعي:</span><span><span id="cart-subtotal-amount">0</span><i class="currency-symbol"></i></span></div>
                <div class="summary-line" id="delivery-fee-line" style="display: none;"><span>رسوم التوصيل:</span><span id="delivery-fee-amount">0</span></div>
                <div class="summary-line total"><span>الإجمالي:</span><span><span id="cart-grand-total-amount">0</span><i class="currency-symbol"></i></span></div>
                <div class="cart-actions"><button class="checkout-btn-whatsapp" id="checkout-btn"><i class="fab fa-whatsapp"></i> إرسال الطلب</button><button class="clear-cart-btn" id="clear-cart-btn">إفراغ السلة</button></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="customization-modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <img src="" class="modal-product-image">
            <h2 class="modal-product-title"></h2>
            <p class="modal-product-base-price"></p><p class="modal-current-item-price"></p>
            <div class="modal-customizations"></div>
            <div class="modal-quantity-controls"><input type="number" value="1" min="1"></div>
            <button class="modal-add-to-cart-btn"><i class="fas fa-cart-plus"></i> أضف للطلبات</button>
        </div>
    </div>

    <div class="map-modal-overlay" id="map-modal-overlay">
        <div class="map-modal-content">
            <div class="map-modal-header"><h3>اختر موقع التوصيل</h3><button class="map-modal-close-btn" id="map-modal-close-btn">&times;</button></div>
            <div id="map"></div>
            <div class="map-modal-footer"><button id="confirm-location-btn">تأكيد الموقع</button></div>
        </div>
    </div>

    <nav class="navbar">
        <a href="#" class="navbar-brand">رغيف الفيصلية</a>
        <a href="#" class="cart-toggle-button" id="desktop-cart-button" aria-label="الذهاب إلى سلة التسوق"><i class="fas fa-shopping-basket"></i><span class="cart-count-badge">0</span></a>
    </nav>

    <div class="container">
        <header class="page-header"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhGHYYhphUac3HG8T-OFi-5IZJMRRA9feFb0dbYZjPZY2gm7-GZzEoF61Nx1VLps5DB3tw17hM8UcrUT_Sxo631yxp4tOPZu8lCCVnpdiQ1n4i7EfUvpYK2KxYDKSX44XZhFH3_MmYwuoQGUUnB99DyWHj4cR4yjlvBSiZjqA4jWurYWFvhBaVv34Mnko6o/s1007/vydt.png" alt="شعار مطعم رغيف الفيصلية"><h1 class="page-title">قائمة الطعام</h1></header>
        <div class="search-controls"><div class="search-container"><i class="fas fa-search search-icon"></i><input type="text" id="search-input" placeholder="ابحث عن وجبتك المفضلة..."></div><button id="toggle-view-btn" class="view-toggle-btn" title="تغيير طريقة العرض"><i class="fas fa-th-large"></i></button></div>
        <div class="filters-container-wrapper"><div class="filters-container" id="filters-container"></div></div>
        <div id="menu-sections"></div>
    </div>
    
    <div class="notification-toast" id="notification-toast"><i class="fas fa-check-circle"></i> <span id="notification-message"></span></div>

    <nav class="mobile-nav">
        <div class="nav-list">
            <a href="#" class="nav-item active" id="nav-menu"><i class="fas fa-utensils"></i><span>القائمة</span></a>
            <a href="#" class="nav-item" id="nav-cart"><i class="fas fa-shopping-basket"></i><span class="cart-count-badge">0</span><span>السلة</span></a>
            <a href="#" class="nav-item" id="nav-about"><i class="fas fa-store"></i><span>من نحن</span></a>
        </div>
    </nav>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- Global Config ---
        let productsData = [];

        // --- Fetch Data and Initialize ---
        document.addEventListener('DOMContentLoaded', () => {
            fetch('products.json?v=' + new Date().getTime()) // Cache busting
                .then(response => response.ok ? response.json() : Promise.reject('Network response was not ok'))
                .then(data => {
                    productsData = data;
                    initializeApp();
                })
                .catch(error => {
                    console.error('Error fetching products:', error);
                    document.getElementById('menu-sections').innerHTML = '<p style="text-align:center; color:red; padding: 20px;">خطأ في تحميل قائمة الطعام. يرجى تحديث الصفحة.</p>';
                    document.getElementById('loading-screen').classList.add('hidden');
                });
        });

        // --- Main App Function ---
        function initializeApp() {
            try {
                // --- DOM Elements ---
                const loadingScreen = document.getElementById('loading-screen');
                const menuSectionsContainer = document.getElementById('menu-sections');
                // ... (and all other DOM element queries from the previous full script)
                // --- All other variables and functions from the previous full script go here ---
                // (loadCart, saveCart, displayProducts, updateCartDisplay, map logic, etc.)

                // --- Final Initial Load inside initializeApp ---
                loadCart();
                loadViewPreference();
                updateCartBadge();
                displayFilterButtons();
                displayProducts();
                populateAllergenTable();

                window.addEventListener('load', () => {
                    setTimeout(() => { if (loadingScreen) loadingScreen.classList.add('hidden'); }, 500);
                });

            } catch (error) {
                console.error("A critical error occurred during initialization:", error);
                if (loadingScreen) loadingScreen.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
